<div class="booking-card">
  <div class="header">
    <h3>
      <span class="price">{{ pricePerNight | currency:'EUR':'symbol':'1.0-0' }}</span>
      <span class="unit"> par nuit</span>
    </h3>
  </div>

  <form [formGroup]="bookingForm" (ngSubmit)="reserve()">
    <div class="date-inputs">
      <mat-form-field appearance="outline" class="date-field">
        <mat-label>Arrivée</mat-label>
        <input matInput [matDatepicker]="pickerStart" formControlName="checkIn">
        <mat-datepicker-toggle matIconSuffix [for]="pickerStart"></mat-datepicker-toggle>
        <mat-datepicker #pickerStart></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="date-field">
        <mat-label>Départ</mat-label>
        <input matInput [matDatepicker]="pickerEnd" formControlName="checkOut">
        <mat-datepicker-toggle matIconSuffix [for]="pickerEnd"></mat-datepicker-toggle>
        <mat-datepicker #pickerEnd></mat-datepicker>
      </mat-form-field>
    </div>

    <mat-form-field appearance="outline" class="guest-field">
      <mat-label>Voyageurs</mat-label>
      <input matInput type="number" formControlName="guests" min="1" [max]="maxGuests">
    </mat-form-field>

    @if (errorMessage()) {
    <div class="error-message">
      {{ errorMessage() }}
    </div>
    }

    @if (isLoading()) {
    <div class="loading-spinner">
      <mat-spinner diameter="30"></mat-spinner>
    </div>
    }

    @if (quote(); as q) {
    <div class="price-breakdown">
      <div class="row">
        <span>{{ pricePerNight | currency:'EUR':'symbol':'1.0-0' }} x {{ q.price.nights }} nuits</span>
        <span>{{ q.price.nightlySubtotal | currency:'EUR':'symbol':'1.0-2' }}</span>
      </div>
      <div class="row">
        <span>Frais de ménage</span>
        <span>{{ q.price.cleaningFee | currency:'EUR':'symbol':'1.0-2' }}</span>
      </div>
      <div class="row">
        <span>Frais de service</span>
        <span>{{ q.price.serviceFee | currency:'EUR':'symbol':'1.0-2' }}</span>
      </div>
      <hr>
      <div class="row total">
        <span>Total</span>
        <span>{{ q.price.total | currency:'EUR':'symbol':'1.0-2' }}</span>
      </div>
    </div>
    }

    <button mat-flat-button color="primary" class="reserve-btn" type="submit" [disabled]="bookingForm.invalid">
      Réserver
    </button>
  </form>

  <div class="footer">
    <p class="cancellation-policy">Politique d'annulation : {{ details.cancellationPolicy }}</p>
  </div>
</div>