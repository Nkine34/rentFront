<mat-card [formGroup]="formGroup" class="form-section-card">
  <mat-card-header>
    <mat-icon mat-card-avatar>payments</mat-icon>
    <mat-card-title>Pricing & Availability</mat-card-title>
    <mat-card-subtitle>Set your base price and define specific availability periods.</mat-card-subtitle>
  </mat-card-header>
  <mat-card-content>
    <!-- Base Pricing Section -->
    <h3>Base Pricing</h3>
    <p>Set the default price for your rental.</p>
    <div class="form-grid">
      <mat-form-field appearance="outline">
        <mat-label>Base Price per Night</mat-label>
        <input matInput type="number" formControlName="basePrice">
        @if (formGroup.get('basePrice')?.hasError('required')) {
          <mat-error>Base price is required</mat-error>
        }
        @if (formGroup.get('basePrice')?.hasError('min')) {
          <mat-error>Must be positive</mat-error>
        }
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Currency</mat-label>
        <mat-select formControlName="currency">
          <mat-option value="USD">USD</mat-option>
          <mat-option value="EUR">EUR</mat-option>
          <mat-option value="GBP">GBP</mat-option>
          <!-- Add other currencies as needed -->
        </mat-select>
        @if (formGroup.get('currency')?.hasError('required')) {
          <mat-error>Currency is required</mat-error>
        }
      </mat-form-field>
    </div>

    <!-- Availability Section -->
    <h3>Availability Periods</h3>
    <p>Define when your property is available and set custom prices for specific periods.</p>

    <div formArrayName="availability">
      @for (period of availability.controls; track period; let i = $index) {
        <mat-card [formGroupName]="i" class="availability-period-card">
          <mat-card-title>Period {{i + 1}}</mat-card-title>
          <mat-card-content>
            <div class="form-grid">
              <mat-form-field appearance="outline">
                <mat-label>Start Date</mat-label>
                <input matInput [matDatepicker]="startDatePicker" formControlName="startDate">
                <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #startDatePicker></mat-datepicker>
                @if (availability.at(i).get('startDate')?.hasError('required')) {
                  <mat-error>Start date is required</mat-error>
                }
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>End Date</mat-label>
                <input matInput [matDatepicker]="endDatePicker" formControlName="endDate">
                <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #endDatePicker></mat-datepicker>
                @if (availability.at(i).get('endDate')?.hasError('required')) {
                  <mat-error>End date is required</mat-error>
                }
              </mat-form-field>
            </div>
            <div class="form-grid">
              <mat-form-field appearance="outline">
                <mat-label>Price per Night for this Period</mat-label>
                <input matInput type="number" formControlName="priceBase">
                @if (availability.at(i).get('priceBase')?.hasError('required')) {
                  <mat-error>Price is required</mat-error>
                }
                @if (availability.at(i).get('priceBase')?.hasError('min')) {
                  <mat-error>Must be positive</mat-error>
                }
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Promotional Rate (Optional)</mat-label>
                <input matInput type="number" formControlName="promoRate">
                @if (availability.at(i).get('promoRate')?.hasError('min')) {
                  <mat-error>Must be positive</mat-error>
                }
              </mat-form-field>
            </div>
            <button mat-stroked-button color="warn" (click)="removeAvailabilityPeriod(i)">
              <mat-icon>delete</mat-icon> Remove Period
            </button>
          </mat-card-content>
        </mat-card>
      }
    </div>

    <button mat-stroked-button color="primary" (click)="addAvailabilityPeriod()">
      <mat-icon>add</mat-icon> Add Availability Period
    </button>
  </mat-card-content>
</mat-card>
