<mat-card [formGroup]="formGroup" class="form-section-card">
  <mat-card-header>
    <mat-icon mat-card-avatar>photo_camera</mat-icon>
    <mat-card-title>Photos & Highlights</mat-card-title>
    <mat-card-subtitle>Showcase your property with beautiful photos and key features.</mat-card-subtitle>
  </mat-card-header>
  <mat-card-content>
    <!-- Photo Upload Section -->
    <h3>Upload Photos</h3>
    <p>Drag and drop your images here, or click to select files.</p>

    <div class="photo-upload-area"
      (drop)="onFileSelect($event)"
      (dragover)="$event.preventDefault()"
      (dragleave)="$event.preventDefault()">
      <input type="file" multiple accept="image/*" (change)="onFileSelect($event)" #fileInput hidden>
      <button mat-flat-button color="primary" (click)="fileInput.click()">
        <mat-icon>cloud_upload</mat-icon> Select Images
      </button>
      <p class="mat-caption">Max {{ MAX_FILES }} files, up to {{ MAX_FILE_SIZE_MB }}MB each. JPG, PNG, GIF.</p>
    </div>

    <div class="previews-container">
      <!-- Existing Photos -->
      @for (photo of existingPhotos; track photo; let i = $index) {
        <mat-card class="preview-item existing-photo">
          <img [src]="photo.url" [alt]="photo.description">
          <button mat-icon-button class="remove-preview-btn" (click)="removeExistingPhoto(i)">
            <mat-icon>close</mat-icon>
          </button>
        </mat-card>
      }

      <!-- New File Previews -->
      @for (preview of previews; track preview; let i = $index) {
        <mat-card class="preview-item new-photo">
          <img [src]="preview" alt="Image preview">
          <button mat-icon-button class="remove-preview-btn" (click)="removeNewFile(i)">
            <mat-icon>close</mat-icon>
          </button>
        </mat-card>
      }
    </div>

    <!-- Highlights Section -->
    <h3>Property Highlights</h3>
    <p>Add a few key features that make your place stand out.</p>

    <div formArrayName="highlights">
      @for (highlight of highlights.controls; track highlight; let i = $index) {
        <div [formGroupName]="i" class="highlight-item">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Highlight Title</mat-label>
            <input matInput formControlName="title" placeholder="e.g., 'Stunning city views'">
            <mat-icon matSuffix>star</mat-icon>
            @if (highlights.at(i).get('title')?.hasError('required')) {
              <mat-error>Highlight is required</mat-error>
            }
          </mat-form-field>
          <button mat-icon-button color="warn" (click)="removeHighlight(i)" class="remove-btn">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      }
    </div>

    <button mat-stroked-button color="primary" (click)="addHighlight()">
      <mat-icon>add</mat-icon> Add Highlight
    </button>
  </mat-card-content>
</mat-card>
