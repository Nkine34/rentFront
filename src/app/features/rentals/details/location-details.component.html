@if (location(); as location) {
<div class="page-wrapper">
  <!-- HERO HEADER (Text based) -->
  <div class="container main-layout">

    <header class="detail-header">
      <div class="header-top">
        <h1 class="font-serif">{{ location.type }}</h1>
        <div class="actions">
          <button mat-button class="action-btn">
            <mat-icon>share</mat-icon> Share
          </button>
          <button mat-button class="action-btn">
            <mat-icon>favorite_border</mat-icon> Save
          </button>
        </div>
      </div>

      <div class="header-meta">
        <div class="rating">
          <mat-icon class="star-icon">star</mat-icon>
          <span class="score">{{ location.rating }}</span>
          <span class="reviews">({{ location.totalReviews }} reviews)</span>
        </div>
        <span class="separator">·</span>
        <span class="location-text underline">{{ location.address.city }}, {{ location.address.country }}</span>
      </div>
    </header>

    <!-- PHOTO GALLERY (Grid) -->
    <section class="gallery-section">
      <div class="gallery-grid">
        @for (photo of sortedPhotos().slice(0,5); track photo.id; let i = $index) {
        <div class="photo-item" [class.main]="i === 0" (click)="openGallery(i)">
          <img [src]="photo.url" [alt]="location.type">
          @if (i === 4) {
          <button class="show-all-btn" (click)="openGallery(0); $event.stopPropagation()">
            <mat-icon>grid_view</mat-icon> Show all photos
          </button>
          }
        </div>
        }
      </div>
    </section>

    <!-- Content Grid -->
    <div class="content-grid two-column">
      <!-- LEFT COLUMN: Details -->
      <main class="details-column">

        <!-- HOST INFO (Row) -->
        <section class="host-section">
          <div class="host-info">
            <h2>Entire Villa hosted by {{ location.host.name }}</h2>
            <p class="specs">
              {{ location.maxGuests }} guests · {{ location.bedrooms }} bedrooms · {{ location.bedrooms }} beds · 4
              baths
            </p>
          </div>
          <img [src]="location.host.photo" class="host-avatar" [alt]="location.host.name">
        </section>

        <hr class="divider">

        <!-- HIGHLIGHTS -->
        <section class="highlights-section">
          @for (highlight of location.highlights; track highlight) {
          <div class="highlight-row">
            <mat-icon class="highlight-icon">check_circle_outline</mat-icon>
            <div class="highlight-text">
              <span class="title">{{ highlight }}</span>
              <span class="desc">One of the most loved homes on Airbnb</span>
            </div>
          </div>
          }
        </section>

        <hr class="divider">

        <!-- DESCRIPTION -->
        <section class="description-section">
          <p>{{ location.description }}</p>
          <button mat-button class="read-more-btn">
            Show more <mat-icon>chevron_right</mat-icon>
          </button>
        </section>

        <hr class="divider">

        <!-- AMENITIES -->
        <section class="amenities-section">
          <h2>What this place offers</h2>
          <div class="amenities-grid">
            <app-amenities-list [amenities]="location.amenities"></app-amenities-list>
          </div>
          <button mat-stroked-button class="show-all-amerities-btn">
            Show all 45 amenities
          </button>
        </section>

        <hr class="divider">

        <!-- REVIEWS SUMMARY -->
        <section class="reviews-summary-section">
          <h2>
            <mat-icon class="star">star</mat-icon>
            {{ location.rating }} · {{ location.totalReviews }} reviews
          </h2>
          <!-- Placeholder for review carousel/list -->
          <app-review-list [locationId]="location.id"></app-review-list>

          <br>
          <button mat-stroked-button>Show all {{location.totalReviews}} reviews</button>
        </section>

        <hr class="divider">

        <!-- LOCATION MAP -->
        <section class="availability-section">
          <div class="section-header">
            <h2>Where you'll be</h2>
          </div>
          <p>{{ location.address.city }}, {{ location.address.country }}</p>

          <div class="map-placeholder">
            <mat-icon>map</mat-icon> Map Component
          </div>
        </section>

      </main>

      <!-- RIGHT COLUMN: Sticky Booking Sidebar -->
      <aside class="booking-sidebar">
        <app-booking-card [locationId]="location.id" [pricePerNight]="location.pricePerNight"
          [details]="location.bookingDetails" [maxGuests]="location.maxGuests" class="sticky-card">
        </app-booking-card>
      </aside>
    </div> <!-- End Content Grid -->

  </div> <!-- End Main Layout Container 1 -->

  <!-- SIMILAR PROPERTIES SECTION -->
  <div class="container main-layout">
    <hr class="divider">

    <section class="similar-properties-section">
      <div class="section-header">
        <h2>Similar properties you might like</h2>
        <div class="nav-arrows">
          <button mat-icon-button disabled><mat-icon>chevron_left</mat-icon></button>
          <button mat-icon-button><mat-icon>chevron_right</mat-icon></button>
        </div>
      </div>

      <div class="similar-grid">
        <!-- Mock Data Cards -->
        <div class="similar-card">
          <div class="img-wrapper">
            <img src="https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&w=600&q=80"
              alt="Villa Aegean">
            <mat-icon class="heart-icon">favorite_border</mat-icon>
          </div>
          <div class="info">
            <div class="top-row">
              <span class="title">Villa Aegean Pearl</span>
              <span class="rating"><mat-icon>star</mat-icon> 4.95</span>
            </div>
            <span class="loc">Imerovigli, Greece</span>
            <span class="price"><strong>$750</strong> / night</span>
          </div>
        </div>

        <div class="similar-card">
          <div class="img-wrapper">
            <img src="https://images.unsplash.com/photo-1600596542815-27a9476cac9b?auto=format&fit=crop&w=600&q=80"
              alt="Cliffside Sanctuary">
            <mat-icon class="heart-icon">favorite_border</mat-icon>
          </div>
          <div class="info">
            <div class="top-row">
              <span class="title">Cliffside Sanctuary</span>
              <span class="rating"><mat-icon>star</mat-icon> 4.98</span>
            </div>
            <span class="loc">Akrotiri, Greece</span>
            <span class="price"><strong>$1,250</strong> / night</span>
          </div>
        </div>

        <div class="similar-card">
          <div class="img-wrapper">
            <img src="https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?auto=format&fit=crop&w=600&q=80"
              alt="White Onyx Suite">
            <mat-icon class="heart-icon">favorite_border</mat-icon>
          </div>
          <div class="info">
            <div class="top-row">
              <span class="title">White Onyx Suite</span>
              <span class="rating"><mat-icon>star</mat-icon> 4.88</span>
            </div>
            <span class="loc">Akrotiri, Greece</span>
            <span class="price"><strong>$900</strong> / night</span>
          </div>
        </div>

        <div class="similar-card">
          <div class="img-wrapper">
            <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=600&q=80"
              alt="Miltox Retreat">
            <mat-icon class="heart-icon">favorite_border</mat-icon>
          </div>
          <div class="info">
            <div class="top-row">
              <span class="title">Miltox Retreat</span>
              <span class="rating"><mat-icon>star</mat-icon> 4.91</span>
            </div>
            <span class="loc">Fira, Greece</span>
            <span class="price"><strong>$1,100</strong> / night</span>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- IMAGE GALLERY OVERLAY -->
  @if (isGalleryOpen()) {
  <app-image-gallery [photos]="sortedPhotos()" [initialIndex]="selectedImageIndex()" (close)="closeGallery()">
  </app-image-gallery>
  }
</div>
} @else if (store.loading()) {
<div class="loading-state">
  <div class="spinner"></div>
  <p>Chargement de votre expérience...</p>
</div>
} @else {
<div class="error-state">
  <h1>Oups !</h1>
  <p>{{ store.error() }}</p>
  <button mat-flat-button color="primary" (click)="goBack()">Retour à l'accueil</button>
</div>
}